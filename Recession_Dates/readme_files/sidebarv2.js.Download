!function(){var e={87851:function(e,t,o){"use strict";var n=o(9571),r=o(73355);t.Z=function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];const s=(0,n.Z)().toString();return(0,r.U)()?new Promise(((e,o)=>{const n=t=>{try{if(t.data){const{data:r}=t,{payload:i}=r;if("PROXY_FETCH_RESPONSE"===r.EVENT_NAME&&i.token===s){if(i.fetchResponseBlob){const t=new Response(i.fetchResponseBlob.stream(),i.fetchResponseProps);e(t)}else i.fetchError?o(i.fetchError):o("Need to handle this");window.removeEventListener("message",n)}}}catch(e){console.log(e)}};window.addEventListener("message",n),(0,r.Z)({EVENT_NAME:"PROXY_FETCH",payload:{fetch:t,token:s}},"*")})):window.fetch(...t)}},73355:function(e,t,o){"use strict";o.d(t,{U:function(){return n}});const n=()=>!!window.BUGHERD_REACT_APP_SIDEBAR_MOUNT&&(window.BUGHERD_REACT_APP_SIDEBAR_MOUNT.getRootNode().querySelector("#bugherdCommunicator")||window.BUGHERD_EXTENSION_CONFIG&&window.BUGHERD_EXTENSION_CONFIG.extensionId);t.Z=function(){if(window.BUGHERD_REACT_APP_SIDEBAR_MOUNT){const e=window.BUGHERD_REACT_APP_SIDEBAR_MOUNT.getRootNode().querySelector("#bugherdCommunicator");if(e)return void e.contentWindow.postMessage(...arguments)}window.BUGHERD_EXTENSION_CONFIG&&window.BUGHERD_EXTENSION_CONFIG.extensionId?window.postMessage(...arguments):console.error("Couldn't find bugherdCommunicator iframe or window.BUGHERD_EXTENSION_CONFIG.extensionId to use for postMessage")}},40629:function(e){var t={cmd:"Cmd",ctrl:"Ctrl",alt:"Alt",shift:"Shift",joinWith:" + "},o={},n={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",32:"Space",36:"Home",33:"Page Up",34:"Page Down",35:"End",37:"Left",38:"Up",39:"Right",40:"Down",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",186:";",187:"=",188:",",189:"-",190:".",192:"`",222:"'"};function r(e){return{character:-1!==[16,17,18,91,93,224].indexOf(e.keyCode)?null:n[e.keyCode]||String.fromCharCode(e.keyCode),modifiers:{cmd:e.metaKey,ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey}}}function s(e){return function(e){var t=r(e),n=t.modifiers,s=[];return n.cmd&&s.push(o.cmd),n.ctrl&&s.push(o.ctrl),n.alt&&s.push(o.alt),n.shift&&s.push(o.shift),t.character&&s.push(t.character),s}(e).join(o.joinWith)}e.exports=function(e){return o=Object.assign(t,e),s},e.exports.details=function(e){var t=r(e),o=t.modifiers,n=o.cmd||o.ctrl||o.alt||o.shift;return{hasKey:null!=t.character,hasModifier:n,map:t}}},9571:function(e,t,o){"use strict";var n;o.d(t,{Z:function(){return l}});var r=new Uint8Array(16);function s(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(r)}for(var i=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,a=function(e){return"string"==typeof e&&i.test(e)},c=[],d=0;d<256;++d)c.push((d+256).toString(16).substr(1));var l=function(e,t,o){var n=(e=e||{}).random||(e.rng||s)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){o=o||0;for(var r=0;r<16;++r)t[o+r]=n[r];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!a(o))throw TypeError("Stringified UUID is invalid");return o}(n)}}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,o),s.exports}o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,{a:t}),t},o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";const e=(e,t,o)=>{o&&e.setAttribute(`data-${t}`,o)};var t=console.log;const n={default:{width:300,height:80,right:0},warning:{width:330,height:144,right:0}},r=()=>document.getElementById("bugherd_embed_communication_frame");let s=null;const i=(e,t)=>{t&&(s=t);const o=r(),{width:i,height:a,right:c}=n[e];o.style.width=`${i}px`,o.style.height=`${a}px`,o.style.top=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:70;return e?`calc((100% - ${t+10}px) * ${e/100})`:"0px"}(t||s,a),o.style.right=`${c}px`},a=e=>{r().style.display=e?"block":"none"},c=()=>{t("[AUTH] Destroying auth iframe"),window.removeEventListener("bugherd_loaded",c),r().remove(),window._bugHerd_sidebar2021=void 0},d={All:!0,"Google Analytics":!1,"Google Analytics 4":!1};var l=o(40629),u=o.n(l);const p=(e,t,o,n,r)=>{document.addEventListener("keyup",(function(e){const t=document.getElementById("bugherd_embed_communication_frame"),o=u()({})(e);"string"==typeof o&&t&&o===(r||"Cmd + Ctrl + B")&&(t.style.display="block")}));const s=e=>{!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n={integrations:{...o.integrations,...d}};window.analytics&&window.analytics.track&&window.analytics.track(e,t,{...n,...o})}("Sidebar displayed",{project_id:o??null,source:e})},i=document.referrer.includes(n),a=window.location.search.includes("showBugherd=true");if(i&&s("app"),a){s("querystring");const e=setTimeout((()=>{const e=new URLSearchParams(window.location.search);e.delete("showBugherd");const t=`${window.location.protocol}//${window.location.host}${window.location.pathname}?${e.toString()}`;window.history.pushState({path:t},"",t)}),1e3);return()=>{clearTimeout(e)}}return!!(i||t||a)},g="hasStorageAccess"in document&&"requestStorageAccess"in document,m=()=>document.getElementById("bugherd_toggle"),w=e=>{m().onclick=e},h=(e,t)=>{if(!e)return;e.custom_logo_dark_background&&(document.getElementById("logo").src=e.custom_logo_dark_background);const o=m();if(null!=o&&o.style){if(e.id){const n=t({projectId:e.id,preference:"togglePosition"});n&&(o.style.transform=`translate(0px, ${n}px)`)}e.toggle_vertical_position&&(o.style.top=`calc((100% - 70px) * ${e.toggle_vertical_position/100})`)}};var _=o(87851).Z,E=o(9571);const y=e=>{let{projectId:t,preferences:o}=e;try{const e={...JSON.parse(window.localStorage.getItem(`sidebar_project_${t}`)),...o};window.localStorage.setItem(`sidebar_project_${t}`,JSON.stringify(e))}catch(e){console.log("Couldnt save user preferences to local storage",e)}},f=e=>{let{projectId:t,preference:o}=e;try{const e=JSON.parse(window.localStorage.getItem(`sidebar_project_${t}`));if(!e)return;return e[o]}catch(e){console.log("Couldnt get user preferences from local storage",e)}};var b,S,v,A,C,T;function O(t){var o=document.createEvent("CustomEvent");if(o.initCustomEvent("bugherdSidebarParsed",!0,!0,JSON.stringify({status:"success",apiKey:t.apiKey})),document.dispatchEvent(o),"loading"===document.readyState)return void document.addEventListener("readystatechange",(e=>{"interactive"===e.target.readyState&&O(t)}));const{resources:n,apiKey:r,origin:s,embeddedByOldExtension:i}=t,{project:a,user:c}=n,d=["app-images","app-css","app-vendor",a.is_public&&!a.authenticated?"public":"app"];(t=>{let{apiKey:o,origin:n,project:r,bugsnagSidebarNewKey:s,embeddedByOldExtension:i,files:a,user:c}=t;const d=document.createElement("bugherd-sidebar");d.style.position="static",e(d,"projectid",r.id.toString()),e(d,"project",JSON.stringify(r)),e(d,"user",JSON.stringify(c)),e(d,"bugsnagsidebarnewkey",s),e(d,"embeddedByOldExtension",i.toString()),d.addEventListener("keydown",(e=>{e.stopPropagation()})),d.addEventListener("focusin",(e=>{e.stopPropagation()}));const l=d.attachShadow({mode:"open"});l.innerHTML='<div id="sidebar-root"></div>',window.BUGHERD_REACT_APP_SIDEBAR_MOUNT=l.getElementById("sidebar-root"),window.BUGHERD_API_KEY=o,(e=>{let{origin:t,files:o}=e;o.forEach((e=>{const o=document.createElement("script");o.src=`${t.replace("www.","sidebar.")}/clients/sidebar/${e}.1693543914701.js`,window.document.head.appendChild(o)}))})({origin:n,files:a}),document.body.appendChild(d)})({apiKey:r,origin:s,project:a,bugsnagSidebarNewKey:n.config.bugsnag_sidebar_new_key,embeddedByOldExtension:i,files:d,user:c})}let N=(e=>{let{embedUrl:t}=e;try{const e=new URL(t).search.replace(/^\?/,"").split("&").map((e=>e.split("="))).reduce(((e,t)=>(e[t[0]]=t[1],e)),{apikey:""});return e&&e.apikey?e.apikey:null}catch{return null}})({embedUrl:(null===(b=document)||void 0===b||null===(S=b.currentScript)||void 0===S?void 0:S.src)||window.embedUrl});null!==(v=window.BUGHERD_EXTENSION_CONFIG)&&void 0!==v&&v.apiKey&&(N=window.BUGHERD_EXTENSION_CONFIG.apiKey);let U=(null===(A=window.BUGHERD_EXTENSION_CONFIG)||void 0===A?void 0:A.domain)||"https://localhost:3000",H="";if(null!==(C=document)&&void 0!==C&&null!==(T=C.currentScript)&&void 0!==T&&T.src){var R,I;const e=new URL(null===(R=document)||void 0===R||null===(I=R.currentScript)||void 0===I?void 0:I.src);U=e.origin,H=e.search}const j=U.replace("www.","sidebar.");if("/sidebar/embed_html"===window.document.location.pathname)(e=>{let{sidebarOrigin:o,apiKey:n}=e;m();const r=(0,E.Z)();let s=!1;window.addEventListener("message",(e=>{if("COOKIE_CHECK"===e.data.eventName)t("[AUTH] Check cookies"),((e,o)=>new Promise(((n,r)=>{_(`${e}/sidebar/resources?apikey=${o}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>e.project.is_active?e.project.authenticated?(t("[AUTH] _bugherd_session5 cookie valid"),n(e)):(document.cookie.includes("_bugherd_session5")?t("[AUTH] _bugherd_session5 cookie invalid"):t("[AUTH] _bugherd_session5 cookie does not exist"),r(e)):(t("[AUTH] Bugherd project disabled"),n(e)))).catch((e=>(t("[AUTH] _bugherd_session5 ping error"),r())))})))(o,n).then((o=>{const{project:n}=o;if(t("[AUTH] Authenticated"),n.active_task_id&&y({projectId:n.id,preferences:{route:`/sidebar/tasks/${n.active_task_id}`}}),!n.is_active)return e.source.postMessage({eventName:"COOKIE_CHECK_RESPONSE",payload:{success:!1,resources:o}},e.origin);n.has_access?m().className="loading":m().className="noAccess",h(n,f);const i=f({projectId:n.id,preference:"route"});let a=e.data.manuallyAuthenticated;window.sessionStorage.getItem("bugherdSidebarManuallyAuthenticated")&&(a=!0,window.sessionStorage.removeItem("bugherdSidebarManuallyAuthenticated")),i&&"/toggle"!==i||!a||y({projectId:n.id,preferences:{route:"/sidebar"}}),(a||s)&&y({projectId:n.id,preferences:{anonymousUserId:r,route:"/sidebar"}}),e.source.postMessage({eventName:"COOKIE_CHECK_RESPONSE",payload:{success:!0,resources:o}},e.origin)})).catch((o=>{const{project:n}=o;t("[AUTH] Unauthenticated"),h(n,f),e.source.postMessage({eventName:"COOKIE_CHECK_RESPONSE",payload:{success:!1,resources:o}},e.origin)}));else if("AUTH_HAS_STORAGE_ACCESS"===e.data.eventName){t("[AUTH] AUTH_HAS_STORAGE_ACCESS");const o=t=>{e.source.postMessage({eventName:"AUTH_HAS_STORAGE_ACCESS_RESPONSE",payload:{success:t}},e.origin)};if(!g)return o(null);document.hasStorageAccess().then((e=>{o(!!e)})).catch((e=>{o(!1)}))}else if("AUTH_REQUEST_STORAGE_ACCESS"===e.data.eventName){let o;t("[AUTH] AUTH_REQUEST_STORAGE_ACCESS");const n=t=>{t||(m().className="error");const n=(new Date).getTime()-o<=250;e.source.postMessage({eventName:"AUTH_REQUEST_STORAGE_ACCESS_RESPONSE",payload:{success:t,isAutoDenied:n,anonymousUserId:r}},e.origin)};w((()=>{var e;o=(new Date).getTime(),e=n,document.requestStorageAccess().then((()=>{e(!0)}),(()=>{e(!1)})),s=!0}))}else"SHOW_UNAUTHENTICATED_UI"===e.data.eventName&&(m().className="",w((()=>{e.source.postMessage({eventName:"AUTH_REDIRECT_TO_LOGIN",payload:{anonymousUserId:r}},e.origin)})))}),!1)})({sidebarOrigin:j,apiKey:N});else{var B,P;const e=document.getElementsByTagName("bugherd-sidebar")[0],o=document.querySelector('script[src*="sidebarv2"]')&&!(null!==(B=document.currentScript)&&void 0!==B&&B.getAttribute("src").includes("sidebarv2")),n=document.querySelector('script[src*="sidebarv2"]')&&(null===(P=document.currentScript)||void 0===P?void 0:P.getAttribute("src").includes("source=extension"));if(e){const t=e.getAttribute("data-projectid");console.warn(`Bugherd: Wanted to embed project with apiKey ${N} but project with id ${t} was already embedded.`)}else if(o)console.warn("Bugherd: Wanted to embed project via new embed code (embed.js) but looks like old embed code exists (sidebarv2.js).");else if(window._bugHerd_sidebar2021)console.warn("Bugherd: Wanted to embed new sidebar but _bugHerd_sidebar2021 was already set");else{if(window._bugHerd_sidebar2021=!0,!N)throw new Error("Bugherd: sidebar is missing apiKey");(e=>{let{origin:o,search:n}=e;return(async e=>{let{origin:t,search:o}=e;try{await new Promise(((e,t)=>{if(document.body)return e(document.body);const o=setTimeout((()=>{t()}),4e3),n=new MutationObserver((function(){document.body&&document.head&&(n.disconnect(),clearTimeout(o),e(document.body))}));n.observe(document.documentElement,{childList:!0})}))}catch(e){return console.error("BugHerd wanted to start but document.body or document.head is null"),null}let n="allow-scripts allow-popups allow-same-origin allow-popups-to-escape-sandbox";"requestStorageAccess"in document&&(n+=" allow-storage-access-by-user-activation");const r=document.createElement("iframe");return r.id="bugherd_embed_communication_frame",r.name="embedCommunication",r.sandbox=n,r.style.display="none",r.style.border="none",r.style.position="fixed",r.style.zIndex="2147483647",r.style.right="0",r.style.height="calc((100% - 154px) * 0.9)",r.src=`${t}/sidebar/embed_html${o}`,document.body.appendChild(r),r})({origin:o,search:n}).then((e=>{if(null===e)throw Error("iFrame wasnt created");return new Promise(((n,r)=>{const s=o.replace("sidebar.","www."),d={hasStorageAccess:void 0,project:null,resources:null};window.addEventListener("bugherd_loaded",c);const l=()=>{var e,t;const o=null===(e=d.project)||void 0===e?void 0:e.always_show_widget,r=null===(t=d.project)||void 0===t?void 0:t.shortcutToShowWidget;let c=!0;c=p(0,o,d.project.id,s,r),a(c),i("default",d.project.toggle_vertical_position),n({authenticated:!0,resources:d.resources})};document.addEventListener("keyup",(function(e){if(null!=d&&d.project){const t=document.getElementById("bugherd_embed_communication_frame"),o=u()({})(e),n=d.project.shortcut_to_show_widget||"Cmd + Ctrl + B";"string"==typeof o&&t&&o===n&&(t.style.display="block")}}));const g=()=>{n({resources:d.resources})};e.onload=()=>{window.addEventListener("message",(n=>((e,o,n)=>{var r,s;let{onSuccess:d,onShowPublicFeedback:l,reject:u,iframe:g,origin:m}=o;"chrome"in window&&(n.hasStorageAccess=null);const w=`${m.replace("sidebar.","www.")}/users/sign_in?source=sidebar&utm_campaign=sidebar&redirect_to=${window.location.href}&anonymous_user_id=${null===(r=e.data)||void 0===r||null===(s=r.payload)||void 0===s?void 0:s.anonymousUserId}`,h=m.replace("sidebar.","www.");if("COOKIE_CHECK_RESPONSE"===e.data.eventName){var _,E;n.project=e.data.payload.resources.project,n.resources=e.data.payload.resources;const o=null===(_=n.project)||void 0===_?void 0:_.always_show_widget,r=null===(E=n.project)||void 0===E?void 0:E.shortcutToShowWidget;let s=!0;s=p(0,o,n.project.id,h,r);const w=window.location.search.includes("showBugherd=true"),y=document.referrer.includes(h);n.project.is_active?null===n.project.id?(t("[BUGHERD] There is no project associated with this API Key"),u(),c()):!n.project.is_public||n.project.authenticated||y&&w?!1===n.hasStorageAccess?(i("default",n.project.toggle_vertical_position),a(s),g.contentWindow.postMessage({eventName:"AUTH_REQUEST_STORAGE_ACCESS",payload:{origin:m}},m)):e.data.payload.success&&!n.project.has_access?(a(s),i("warning",n.project.toggle_vertical_position)):e.data.payload.success?d():null!==n.hasStorageAccess||n.project.always_show_widget?n.project.always_show_widget?a(!0):(g.contentWindow.postMessage({eventName:"SHOW_UNAUTHENTICATED_UI",payload:{origin:m,projectOrigin:window.location.origin}},m),i("warning",n.project.toggle_vertical_position),n.project.authenticated&&a(s)):a(s):l():(t(`[BUGHERD] Project (${n.project.id}) is disabled`),u(),c())}else"AUTH_HAS_STORAGE_ACCESS_RESPONSE"===e.data.eventName?(n.hasStorageAccess=e.data.payload.success,null===e.data.payload.success?(t("[AUTH] hasStorageAccess: no api"),g.contentWindow.postMessage({eventName:"COOKIE_CHECK",payload:{origin:m}},m)):e.data.payload.success?(t("[AUTH] hasStorageAccess: true"),g.contentWindow.postMessage({eventName:"COOKIE_CHECK",payload:{origin:m}},m)):(t("[AUTH] hasStorageAccess: false"),g.contentWindow.postMessage({eventName:"COOKIE_CHECK",payload:{origin:m}},m))):"AUTH_REQUEST_STORAGE_ACCESS_RESPONSE"===e.data.eventName?e.data.payload.success?(n.hasStorageAccess=!0,t("[AUTH] requestStorageAccess: true"),i("default"),g.contentWindow.postMessage({eventName:"COOKIE_CHECK",payload:{origin:m,manuallyAuthenticated:!0}},m)):(t("[AUTH] requestStorageAccess: false"),i("warning"),e.data.payload.isAutoDenied&&(window.location.href=w)):"AUTH_REDIRECT_TO_LOGIN"===e.data.eventName&&(window.location.href=w)})(n,{onSuccess:l,onShowPublicFeedback:g,reject:r,iframe:e,origin:o},d)),!1),e.contentWindow.postMessage({eventName:"AUTH_HAS_STORAGE_ACCESS",payload:{origin:o}},o)}}))})).catch((e=>{console.error("Cannot initialize BugHerd")}))})({origin:j,search:H}).then((e=>{let{resources:t}=e;O({apiKey:N,origin:U,resources:t,embeddedByOldExtension:n})})).catch((e=>{e&&console.error("[AUTH] Unauthenticated",e)}))}}}()}();
//# sourceMappingURL=embed.1693543914701.js.map;
